{% extends "base.html" %}
{% set page_title = t.workers %}
{% block body %}

<h1 class="page-title" style="display:flex;align-items:center;justify-content:space-between">
  <span>üë®‚Äçüíºüì≤ {{ t.workers }}</span>
  <button class="btn" id="openWorkerModal">{{ t.add }}</button>
</h1>

<!-- ÂàóË°® -->
<div class="panel">
  <table>
    <thead>
      <tr>
        <th>ID</th>
        <th>{{ t.name }}</th>
        <th>{{ t.company }}</th>
        <th>{{ t.commission }}</th>
        <th>{{ t.expenses }}</th>
        <th>{{ t.status }}</th>
        <th>{{ t.created_at }}</th>
        <th>{{ t.actions }}</th>
      </tr>
    </thead>
    <tbody>
      {% for r in rows %}
      <tr>
        <td>{{ r.id }}</td>
        <td>{{ r.name }}</td>
        <td>{{ r.company or '-' }}</td>
        <td>{{ '%.2f'|format(r.commission or 0) }}</td>
        <td>{{ '%.2f'|format(r.expenses or 0) }}</td>
        <td>
          {% if r.is_active %}
            <span class="badge on">{{ t.active }}</span>
          {% else %}
            <span class="badge off">{{ t.inactive }}</span>
          {% endif %}
        </td>
        <td>{{ r.created_at }}</td>
        <td>
          <form method="post" action="{{ url_for('workers_toggle', wid=r.id) }}" style="display:inline">
            <button class="btn soft" type="submit">
              {% if r.is_active %}{{ t.deactivate }}{% else %}{{ t.activate }}{% endif %}
            </button>
          </form>
          <a class="btn" href="{{ url_for('workers_edit_form', wid=r.id) }}">{{ t.edit }}</a>
          <form method="post" action="{{ url_for('workers_delete', wid=r.id) }}" style="display:inline"
                onsubmit="return confirm('{{ t.confirm_delete }}')">
            <button class="btn danger" type="submit">{{ t.delete }}</button>
          </form>
        </td>
      </tr>
      {% else %}
      <tr><td colspan="8" class="empty">{{ t.empty }}</td></tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<!-- ================== ÁæéËßÇÂºπÁ™óÔºöÂ∑•‰∫∫ / Âπ≥Âè∞ÔºàÊñ∞Â¢ûÔºâ ================== -->
<style>
/* ‚Äî‚Äî ‰ªÖÊú¨È°µÊ†∑ÂºèÔºàwk-* ÂâçÁºÄÔºâÔºå‰∏çÂΩ±ÂìçÂÖ®Á´ô ‚Äî‚Äî */
.wk-modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;z-index:60}
.wk-modal.show{display:flex;animation:wk-fadeIn .18s ease}
.wk-backdrop{position:absolute;inset:0;background:rgba(0,0,0,.55);backdrop-filter:blur(3px)}
.wk-dialog{
  position:relative; z-index:1; width:min(720px,92vw);
  border-radius:16px; padding:0; overflow:hidden;
  background:
    linear-gradient(180deg, rgba(148,163,184,.08), rgba(148,163,184,.04)) padding-box,
    linear-gradient(135deg, rgba(96,165,250,.75), rgba(167,139,250,.75), rgba(250,204,21,.55)) border-box;
  border:1px solid transparent;
  box-shadow:0 18px 60px rgba(0,0,0,.38);
  animation:wk-popIn .18s ease;
}
.wk-header{
  display:flex;align-items:center;justify-content:space-between;gap:10px;
  padding:14px 16px;
  background:linear-gradient(180deg, rgba(17,24,39,.92), rgba(17,24,39,.65));
  border-bottom:1px solid rgba(148,163,184,.18);
}
.wk-title{display:flex;align-items:center;gap:10px;font-weight:800}
.wk-sub{font-size:12px;color:var(--muted)}
.wk-close{background:transparent;border:0;color:var(--text);font-size:20px;line-height:1;cursor:pointer;opacity:.9}
.wk-close:hover{opacity:1;transform:scale(1.06)}

.wk-body{padding:14px 16px}
.wk-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px}
@media (max-width:720px){.wk-grid{grid-template-columns:1fr}}

.wk-field{
  display:flex;flex-direction:column;gap:6px;
  background:rgba(14,20,35,.9); border:1px solid rgba(148,163,184,.28);
  border-radius:12px; padding:10px 10px 9px;
  transition:border-color .15s ease, box-shadow .15s ease, background .15s ease;
}
.wk-field:focus-within{
  border-color:rgba(54,89,214,.55);
  box-shadow:0 0 0 3px rgba(54,89,214,.18);
  background:rgba(18,24,41,.95);
}
.wk-field label{font-size:12px;color:#cbd5e1;letter-spacing:.2px}
.wk-field input{
  border:0;outline:none;background:transparent;color:var(--text)
}
.wk-field input::placeholder{color:#93a4c0}

.wk-actions{
  display:flex;gap:10px;justify-content:flex-end;
  padding:12px 16px;
  background:linear-gradient(180deg, rgba(17,24,39,.4), rgba(17,24,39,.25));
  border-top:1px solid rgba(148,163,184,.12);
}
.btn.primary{
  background:linear-gradient(180deg,#2b57f0,#274fe0);
  border-color:rgba(147,163,184,.28);
  color:#fff;
}
.btn.primary:hover{filter:brightness(1.06)}
.btn.ghost{background:transparent;border:1px solid rgba(148,163,184,.28)}

@keyframes wk-popIn{from{transform:translateY(8px) scale(.98);opacity:.0}to{transform:none;opacity:1}}
@keyframes wk-fadeIn{from{opacity:.0}to{opacity:1}}
</style>

<div class="wk-modal" id="workerModal" aria-hidden="true">
  <div class="wk-backdrop" data-close></div>

  <div class="wk-dialog" role="dialog" aria-modal="true" aria-labelledby="wk_title">
    <div class="wk-header">
      <div>
        <div id="wk_title" class="wk-title">üë®‚Äçüíºüì≤ {{ t.add }} ¬∑ {{ t.workers }}</div>
        <div class="wk-sub">{{ t.name }}„ÄÅ{{ t.company }}„ÄÅ{{ t.commission }}„ÄÅ{{ t.expenses }}</div>
      </div>
      <button class="wk-close" type="button" title="Close" aria-label="Close" data-close>√ó</button>
    </div>

    <form method="post" action="{{ url_for('workers_add') }}">
      <div class="wk-body">
        <div class="wk-grid">
          <div class="wk-field" style="grid-column:1/-1">
            <label for="wk_name">{{ t.name }}</label>
            <input id="wk_name" name="name" placeholder="{{ t.name }}" required>
          </div>

          <div class="wk-field">
            <label for="wk_company">{{ t.company }}</label>
            <input id="wk_company" name="company" placeholder="{{ t.company }}">
          </div>

          <div class="wk-field">
            <label for="wk_commission">{{ t.commission }}</label>
            <input id="wk_commission" name="commission" type="number" step="0.01" min="0" placeholder="0.00">
          </div>

          <div class="wk-field" style="grid-column:1/-1">
            <label for="wk_expenses">{{ t.expenses }}</label>
            <input id="wk_expenses" name="expenses" type="number" step="0.01" min="0" placeholder="0.00">
          </div>
        </div>
      </div>

      <div class="wk-actions">
        <button class="btn ghost" type="button" data-close>{{ t.back }}</button>
        <button class="btn primary" type="submit">{{ t.submit }}</button>
      </div>
    </form>
  </div>
</div>

<script>
(function(){
  const modal = document.getElementById('workerModal');
  const openBtn = document.getElementById('openWorkerModal');
  const firstInput = document.getElementById('wk_name');

  function openModal(){
    modal.classList.add('show');
    document.documentElement.style.overflow = 'hidden';
    setTimeout(()=> firstInput && firstInput.focus(), 60);
  }
  function closeModal(){
    modal.classList.remove('show');
    document.documentElement.style.overflow = '';
  }

  openBtn?.addEventListener('click', openModal);
  modal?.addEventListener('click', (e)=>{ if(e.target.matches('[data-close]')) closeModal(); });
  window.addEventListener('keydown', (e)=>{ if(e.key==='Escape' && modal.classList.contains('show')) closeModal(); });
})();
</script>

{% endblock %}
