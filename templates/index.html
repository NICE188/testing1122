{% extends "base.html" %}
{% set page_title = t.dashboard %}
{% block body %}
<h1 class="page-title">{{ t.dashboard }}</h1>

<div class="cards">
  <div class="card"><div class="metric-title">{{ t.total_workers }}</div><div class="metric-num">{{ total_workers }}</div></div>
  <div class="card"><div class="metric-title">{{ t.total_rentals }}</div><div class="metric-num">{{ '%.2f'|format(total_rentals or 0) }}</div></div>
  <div class="card"><div class="metric-title">{{ t.total_salaries }}</div><div class="metric-num">{{ '%.2f'|format(total_salaries or 0) }}</div></div>
  <div class="card"><div class="metric-title">{{ t.total_expenses }}</div><div class="metric-num">{{ '%.2f'|format(total_expenses or 0) }}</div></div>
</div>

<div class="tip">{{ t.welcome_tip }}</div>

<div class="panel">
  <canvas id="barChart" height="110"></canvas>
</div>

<script>
(async function(){
  try{
    const res = await fetch('/api/summary');
    const data = await res.json();
    const ctx = document.getElementById('barChart');
    if(!ctx) return;

    new Chart(ctx, {
      type: 'bar',
      data: {
        labels: data.months,
        datasets: [
          { label: 'Card Rentals', data: data.rentals },
          { label: 'Salaries', data: data.salaries },
          { label: 'Expenses', data: data.expenses }
        ]
      },
      options: {
        responsive: true,
        scales: { y: { beginAtZero: true } }
      }
    });
  }catch(e){ console.error(e); }
})();
</script>
{% endblock %}
