{% extends "base.html" %}
{% block content %}
<div class="stats">
  <div class="stat">
    <div class="muted">{{ _('TotalWorkers') }}</div>
    <div class="stat-num">{{ total_workers }}</div>
  </div>
  <div class="stat">
    <div class="muted">{{ _('TotalCardRentals') }}</div>
    <div class="stat-num">{{ '%.2f'|format(total_rentals or 0) }}</div>
  </div>
  <div class="stat">
    <div class="muted">{{ _('TotalSalaries') }}</div>
    <div class="stat-num">{{ '%.2f'|format(total_salaries or 0) }}</div>
  </div>
</div>

<div class="panel muted" style="margin-bottom:16px;">{{ _('DashboardTip') }}</div>

<div class="panel">
  <div class="panel-head">
    <h3>{{ _('MonthlyTitle') }}</h3>
    <select id="monthsSelect" class="select">
      <option value="6">{{ _('Last6') }}</option>
      <option value="12">{{ _('Last12') }}</option>
    </select>
  </div>
  <canvas id="barChart" height="120"></canvas>
</div>

<script>
  let barChart;
  async function loadChart(months=6){
    const res = await fetch(`/api/overview/monthly?months=${months}`);
    const data = await res.json();
    const ctx = document.getElementById('barChart').getContext('2d');
    if(barChart){ barChart.destroy(); }
    barChart = new Chart(ctx, {
      type: 'bar',
      data: {
        labels: data.labels,
        datasets: [
          { label: 'Card Rentals', data: data.rentals, borderWidth: 1 },
          { label: 'Salaries', data: data.salaries, borderWidth: 1 }
        ]
      },
      options: {
        responsive: true,
        scales: {
          y: { beginAtZero: true }
        },
        plugins: {
          legend: { labels: { color: '#e5e7eb' } }
        }
      }
    });
  }
  document.getElementById('monthsSelect').addEventListener('change', (e)=> loadChart(parseInt(e.target.value,10)));
  loadChart(6);
</script>
{% endblock %}
